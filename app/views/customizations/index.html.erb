<h1>MAKE YOUR OWN LESSON</h1>
<div class="lesson-select">
  <div class="card">
      <button class="btn mb-3 mx-auto" id="customization-btn">CREATE</button> 
  </div>
</div>

<!-- Customization 隱藏欄位 -->
<div class="card d-none">
  <div class="card-body">
    <%= form_for @topic do |f| %>
      <div class="form-row">
        <div class="form-group mr-2">
          <%= f.label :content %>
          <%= f.text_field :content, class: 'form-control' %>
          <%= f.hidden_field :type, value: 'Customization' %>
        </div>
        <div class="form-group">
          <%= f.submit class: 'btn btn-primary', id: 'customization_submit' %>
        </div>
      </div>
    <% end %>
  </div>   
</div>


<div class="lesson-select">
  <% start = 1 %>
  <div class= "card">
    <% @user_topics.each do |topic| %>
      <% if topic.topic %>
        <div class="col-lg-4 col-md-6 col-sm-12">
          <div class="card-body" style="display: flex;flex-flow: column;justify-content: space-around">
            <% if current_user %>
            
              <div class="accracy d-none"><%= @all_progress[n] %></div>

              <% if @done_customization.include?(topic.topic_id) %>
                <div class="check-done">
                  <img src="/icon/check-circle.svg" alt="">
                </div>
              <% end %>
            <% end %>
            <h5 class="card-title" id="lessonTitle">Lesson<%= "#{start}" %></h5>
            <p class="card-text ellipsis"><%= topic.topic.content %></p>
            <div class="link-group d-flex">
              <%= link_to "Start", send("customization_path", id: topic.topic.id), class: 'btn', id: "play-start" %>
              <%= link_to(image_tag('/icon/edit-custom.svg'),  edit_customization_path(topic.topic.id))%>
              <%= link_to(image_tag('/icon/trash-2.svg'),  customization_path(topic.topic.id), class:'trash',id: "delete-custom-btn", method: "DELETE") %>
            </div>
            <div class="stars d-flex" id=lessonBar<%= start %>>
            </div> 
          </div>        
        </div>

          <% start += 1 %>
          
      <% end %>
    <% end %>
  </div>
</div>

<script>
  let customizationBtn = document.querySelector('#customization-btn')
  let deleteCustomBtn = document.querySelectorAll('#delete-custom-btn')
  let customizationContent = document.querySelector('#customization_content')
  // let roomDescription = document.querySelector('#room_description')
  let createBtn = document.querySelector('#customization_submit')
  
  customizationBtn.addEventListener('click', () => {
    getData();
  })
  async function getData() {
    const { value: formValues } = await Swal.fire({
      title: 'MAKE YOUR OWN LESSON',
      showCancelButton: true,
      confirmButtonText: 'Yes, Create it!',
      html:
        '<textarea id="swal-input1" class="swal2-input" placeholder="Topic content"></textarea>',
      focusConfirm: false,
      preConfirm: () => {
        let topicContent = document.getElementById('swal-input1')
        // let inputDescription = document.getElementById('swal-input2')
        if (topicContent.value === '') {
          Swal.showValidationMessage(
            `Request failed: Name and Description `
          )
        } else {
          return [
            topicContent.value,
          ]
        }
      }
    })

    if (formValues) {

      let timerInterval
      Swal.fire({
        title: 'Topic has created!',
        timer: 2000,
        timerProgressBar: false,
        onClose: () => {
          clearInterval(timerInterval)
        }
      }).then(() => {
        customizationContent.value = formValues[0]
        createBtn.click()
      })
    }
  }
  /* delete room 彈出視窗 */
  let stepStatus = false
  deleteCustomBtn.forEach((deleteBtn) => {
    deleteBtn.addEventListener('click', (trash) => {
      if (stepStatus === false) {
        trash.preventDefault();
        trash.stopPropagation();
          Swal.fire({
          title: 'Are you sure?',
          text: "You won't be able to revert this!",
          icon: 'warning',
          showCancelButton: true,
          confirmButtonColor: '#ff67c0',
          cancelButtonColor: '#eec44c',
          confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
          if (result.value) {
            Swal.fire({
              icon: 'success',
              title: 'Your room has deleted!',
              showConfirmButton: false,
              timer: 1500
            })
            stepStatus = true;
            setTimeout(() => {
              deleteBtn.click();
            }, 1000);
          }
        })
      }
      if (stepStatus === true) {
        stepStatus = false
      }
    })
  })
</script>